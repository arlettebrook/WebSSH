import{d as F,r as z,o as S,a as Y,c as T,w as t,b as e,e as d,u as o,f as q,g as C,E as V,h as G,i as A,j as ae,k as O,l as J,m as K,n as Q,p as W,q as X,s as ne,t as ie,v as j,x as P,y as B,z as be,A as R,B as Z,C as ge,D as ye,F as ee,G as de,H as se,I as xe,J as ve,K as we,L as he,M as Ve,N as Ce,O as Ne,P as ke,Q as Ue}from"./index-BFPhbx9o.js";const Ee={class:"dialog-footer"},Ye=F({__name:"Account",setup(H){let a=z({mode:0,user_dialog_visible:!1,active_name:"accoutManage",user_list:Array(),is_admin:!0}),l=z({id:0,name:"",pwd:"",desc_info:"",is_admin:"N",is_enable:"Y",is_root:"N",expiry_at:new Date(2050,0,0,0,0,0)});function y(_=0,s=1e4){C.get(`/api/user?offset=${_}&limit=${s}`).then(x=>{x.data.code===0?a.user_list=x.data.data:V.error("获取用户列表错误")})}function g(){l.id=0,l.name="",l.pwd="",l.desc_info="",l.is_admin="N",l.is_enable="Y",l.is_root="N",l.expiry_at=new Date(2050,0,0,0,0,0),a.user_dialog_visible=!0}function m(_){l.id=_.id,l.name=_.name,l.pwd=_.pwd,l.desc_info=_.desc_info,l.is_admin=_.is_admin,l.is_enable=_.is_enable,l.is_root=_.is_root,l.expiry_at=_.expiry_at,a.user_dialog_visible=!0}function r(){return{id:l.id,name:l.name,pwd:l.pwd,desc_info:l.desc_info,is_admin:l.is_admin,is_enable:l.is_enable,is_root:l.is_root,expiry_at:P(l.expiry_at).format("YYYY-MM-DD HH:mm:ss")}}function N(){C.put("/api/user",r()).then(_=>{_.data.code===0?a.user_list=_.data.data:V.error("更新用户错误,请检查输入")})}function p(_){C.delete(`/api/user/${_}`).then(s=>{s.data.code===0?a.user_list=s.data.data:V.error("删除用户错误")})}function h(){C.post("/api/user",r()).then(_=>{_.data.code===0?a.user_list=_.data.data:V.error("创建用户错误,请检查输入")})}function k(){l.id===0?h():N(),l.id=0,l.name="",l.pwd="",l.desc_info="",l.is_admin="N",l.is_enable="Y",l.is_root="N",l.expiry_at=new Date(2050,0,0,0,0,0),a.user_dialog_visible=!1}return S(()=>{y()}),(_,s)=>{const x=G,v=A,D=ae,n=O,i=J,c=K,E=Q,w=W,$=X,U=ne,b=ie,I=j;return Y(),T(I,{label:"账号管理",name:"accoutManage"},{default:t(()=>[e(n,{data:o(a).user_list,style:{width:"100%"},"show-overflow-tooltip":!0},{default:t(()=>[e(x,{fixed:"",sortable:"",prop:"name",label:"用户名"}),e(x,{sortable:"",prop:"desc_info",label:"备注信息",width:"200"}),e(x,{sortable:"",prop:"is_admin",label:"是否管理员"}),e(x,{sortable:"",prop:"is_enable",label:"是否启用"}),e(x,{sortable:"",prop:"expiry_at",label:"过期时间",width:"180"}),e(x,{fixed:"right",label:"操作"},{header:t(()=>[e(v,{size:"small",type:"primary",onClick:g},{default:t(()=>[d("新增")]),_:1}),e(v,{size:"small",type:"primary",onClick:s[0]||(s[0]=f=>y(0,1e4))},{default:t(()=>[d("刷新")]),_:1})]),default:t(f=>[e(v,{size:"small",type:"success",onClick:L=>m(f.row)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),e(D,{confirmButtonText:"删除",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定删除吗",onConfirm:L=>p(f.row.id)},{reference:t(()=>[e(v,{size:"small",type:"danger"},{default:t(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(b,{title:"用户信息",modelValue:o(a).user_dialog_visible,"onUpdate:modelValue":s[8]||(s[8]=f=>o(a).user_dialog_visible=f),width:"60%"},{footer:t(()=>[q("span",Ee,[e(v,{onClick:s[7]||(s[7]=f=>o(a).user_dialog_visible=!1)},{default:t(()=>[d("取消")]),_:1}),e(v,{type:"success",onClick:k},{default:t(()=>[d("保存")]),_:1})])]),default:t(()=>[e(U,{"label-width":"80px",size:"small"},{default:t(()=>[e(c,{label:"备注名",prop:"desc_info"},{default:t(()=>[e(i,{minlength:"1",maxlength:"60",modelValue:o(l).desc_info,"onUpdate:modelValue":s[1]||(s[1]=f=>o(l).desc_info=f),modelModifiers:{trim:!0},"show-word-limit":"",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),e(c,{label:"用户名",prop:"name"},{default:t(()=>[e(i,{modelValue:o(l).name,"onUpdate:modelValue":s[2]||(s[2]=f=>o(l).name=f),modelModifiers:{trim:!0},minlength:"1",maxlength:"30","show-word-limit":"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(c,{label:"密码",prop:"pwd"},{default:t(()=>[e(i,{minlength:"1",maxlength:"60",modelValue:o(l).pwd,"onUpdate:modelValue":s[3]||(s[3]=f=>o(l).pwd=f),modelModifiers:{trim:!0},type:"passrowd","show-password":"","show-word-limit":"",placeholder:"用户密码"},null,8,["modelValue"])]),_:1}),e(c,{label:"管理员",prop:"is_admin"},{default:t(()=>[e(w,{modelValue:o(l).is_admin,"onUpdate:modelValue":s[4]||(s[4]=f=>o(l).is_admin=f),id:"is_admin"},{default:t(()=>[e(E,{value:"Y"},{default:t(()=>[d("是")]),_:1}),e(E,{value:"N"},{default:t(()=>[d("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"启用",prop:"is_enable"},{default:t(()=>[e(w,{modelValue:o(l).is_enable,"onUpdate:modelValue":s[5]||(s[5]=f=>o(l).is_enable=f),id:"is_enable"},{default:t(()=>[e(E,{value:"Y"},{default:t(()=>[d("是")]),_:1}),e(E,{value:"N"},{default:t(()=>[d("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"过期时间"},{default:t(()=>[e($,{modelValue:o(l).expiry_at,"onUpdate:modelValue":s[6]||(s[6]=f=>o(l).expiry_at=f),type:"datetime",placeholder:"选择账号过期时间"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),$e=F({__name:"Connect",setup(H){let a=z({host_list:Array(),is_admin:!0});function l(g,m){try{C.post(`/api/ssh/disconnect?session_id=${m.session_id}`)}catch(r){console.log(r)}}function y(){if(a.is_admin){var g=new EventSource(`/api/conn_manage/online_client/?Authorization=${localStorage.getItem("token")}`);g.onmessage=function(m){let r=JSON.parse(m.data);r.code===0&&(a.is_admin=!0,a.host_list=r.data)}}}return S(()=>{y()}),(g,m)=>{const r=G,N=A,p=O,h=j;return Y(),T(h,{label:"连接状态",name:"connectInfo"},{default:t(()=>[e(p,{data:o(a).host_list,style:{width:"100%"},"show-overflow-tooltip":!0},{default:t(()=>[e(r,{fixed:"",prop:"name",label:"名称"}),e(r,{fixed:"",prop:"address",label:"服务器地址",width:"150"}),e(r,{prop:"port",label:"端口",width:"60"}),e(r,{prop:"user",label:"用户名"}),e(r,{prop:"client_ip",label:"客户端IP"}),e(r,{prop:"session_id",label:"会话ID",width:"180"}),e(r,{prop:"last_active_time",label:"最后活跃时间",width:"150"}),e(r,{prop:"start_time",label:"连接创建时间",width:"150"}),e(r,{fixed:"right",label:"操作"},{default:t(k=>[e(N,{size:"small",type:"danger",onClick:_=>l(k.$index,k.row)},{default:t(()=>[d("断开")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})}}}),De={key:0},ze={key:1},Me={class:"dialog-footer"},Be=F({__name:"NetFilter",setup(H){let a=z({mode:0,net_filter_dialog_visible:!1,net_filter_list:Array(),policy_conf:"N"}),l=z({id:0,name:"",cidr:"",net_policy:"N",policy_no:32768,expiry_at:new Date(2050,0,0,0,0,0)});const y=B(""),g=B("ALL"),m=be(()=>a.net_filter_list.filter(n=>g.value==="ALL"?!y.value||n.name.toLowerCase().includes(y.value.toLowerCase()):n.net_policy===g.value&&n.name.toLowerCase().includes(y.value.toLowerCase())));function r(n=0,i=1e4){C.get(`/api/net_filter?offset=${n}&limit=${i}`).then(c=>{c.data.code===0?a.net_filter_list=c.data.data:V.error("获取策略列表错误")})}function N(){l.id=0,l.name="",l.cidr="",l.net_policy="Y",l.policy_no=32768,l.expiry_at=new Date(2050,0,0,0,0,0),a.net_filter_dialog_visible=!0}function p(n){l.id=n.id,l.name=n.name,l.cidr=n.cidr,l.net_policy=n.net_policy,l.policy_no=n.policy_no,l.expiry_at=n.expiry_at,a.net_filter_dialog_visible=!0}function h(){return{id:l.id,name:l.name,cidr:l.cidr,net_policy:l.net_policy,policy_no:l.policy_no,expiry_at:P(l.expiry_at).format("YYYY-MM-DD HH:mm:ss")}}function k(){C.put("/api/net_filter",h()).then(n=>{n.data.code===0?a.net_filter_list=n.data.data:V.error("更新策略错误,请检查输入")})}function _(n){C.delete(`/api/net_filter/${n}`).then(i=>{i.data.code===0?a.net_filter_list=i.data.data:V.error("删除策略错误")})}function s(){C.post("/api/net_filter",h()).then(n=>{n.data.code===0?a.net_filter_list=n.data.data:V.error("创建策略错误,请检查输入")})}function x(){l.id===0?s():k(),l.id=0,l.name="",l.cidr="",l.net_policy="Y",l.policy_no=32768,l.expiry_at=new Date(2050,0,0,0,0,0),a.net_filter_dialog_visible=!1}function v(){C.get("/api/policy_conf/1").then(n=>{n.data.code===0?a.policy_conf=n.data.data.net_policy:V.error("获取策略配置错误")})}function D(){C.put("/api/policy_conf",{id:1,net_policy:a.policy_conf}).then(n=>{n.data.code===0?(a.policy_conf=n.data.data.net_policy,V.success("更新策略成功")):V.error("更新策略失败")})}return S(()=>{v(),r()}),(n,i)=>{const c=Q,E=W,w=K,$=Z,U=A,b=ae,I=ge,f=ye,L=J,te=ee,le=de,M=G,oe=se,_e=O,re=xe,pe=X,ue=ne,ce=ie,me=j;return Y(),T(me,{label:"访问控制",name:"netFilter"},{default:t(()=>[e(le,{"body-style":{height:"36px","padding-top":"0px","padding-bottom":"0px"}},{default:t(()=>[e(te,{style:{height:"24px","padding-top":"6px"}},{default:t(()=>[e($,{span:6,style:{height:"24px"}},{default:t(()=>[e(w,{label:"默认策略"},{default:t(()=>[e(E,{modelValue:o(a).policy_conf,"onUpdate:modelValue":i[0]||(i[0]=u=>o(a).policy_conf=u)},{default:t(()=>[e(c,{value:"N"},{default:t(()=>[d("拒绝")]),_:1}),e(c,{value:"Y"},{default:t(()=>[d("允许")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e($,{span:2,style:{height:"24px"}},{default:t(()=>[e(w,{label:""},{default:t(()=>[e(b,{confirmButtonText:"确定",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定修改策略?",onConfirm:D},{reference:t(()=>[e(U,{type:"danger"},{default:t(()=>[d("保存策略")]),_:1})]),_:1})]),_:1})]),_:1}),e($,{span:8}),e($,{span:8,style:{"text-align":"right",height:"24px"}},{default:t(()=>[e(w,{label:"搜索:"},{default:t(()=>[e(L,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=u=>y.value=u),style:{"max-width":"400px"},placeholder:"请输入策略名称",class:"input-with-select"},{prepend:t(()=>[e(f,{modelValue:g.value,"onUpdate:modelValue":i[1]||(i[1]=u=>g.value=u),placeholder:"选择策略",style:{width:"115px"}},{default:t(()=>[e(I,{label:"全部",value:"ALL"}),e(I,{label:"允许",value:"Y"}),e(I,{label:"拒绝",value:"N"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(le,null,{default:t(()=>[e(te,null,{default:t(()=>[e(_e,{data:m.value,style:{width:"100%"},"show-overflow-tooltip":!0},{default:t(()=>[e(M,{fixed:"",sortable:"",prop:"name",label:"名称",width:"200"}),e(M,{sortable:"",prop:"cidr",label:"CIDR"}),e(M,{sortable:"",prop:"net_policy",label:"策略"},{default:t(u=>[u.row.net_policy==="Y"?(Y(),R("div",De,[e(oe,{type:"success"},{default:t(()=>[d("允许")]),_:1})])):(Y(),R("div",ze,[e(oe,{type:"danger"},{default:t(()=>[d("拒绝")]),_:1})]))]),_:1}),e(M,{sortable:"",prop:"policy_no",label:"策略编号",width:"100"}),e(M,{sortable:"",prop:"expiry_at",label:"过期时间",width:"180"}),e(M,{fixed:"right",label:"操作"},{header:t(()=>[e(U,{size:"small",type:"primary",onClick:N},{default:t(()=>[d("新增")]),_:1}),e(U,{size:"small",type:"primary",onClick:i[3]||(i[3]=u=>r(0,1e4))},{default:t(()=>[d("刷新")]),_:1})]),default:t(u=>[e(U,{size:"small",type:"success",onClick:fe=>p(u.row)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),e(b,{confirmButtonText:"删除",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定删除吗",onConfirm:fe=>_(u.row.id)},{reference:t(()=>[e(U,{size:"small",type:"danger"},{default:t(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),e(ce,{title:"策略配置",modelValue:o(a).net_filter_dialog_visible,"onUpdate:modelValue":i[10]||(i[10]=u=>o(a).net_filter_dialog_visible=u),width:"60%"},{footer:t(()=>[q("span",Me,[e(U,{onClick:i[9]||(i[9]=u=>o(a).net_filter_dialog_visible=!1)},{default:t(()=>[d("取消")]),_:1}),e(U,{type:"success",onClick:x},{default:t(()=>[d("保存")]),_:1})])]),default:t(()=>[e(ue,{"label-width":"80px",size:"small"},{default:t(()=>[e(w,{label:"名称",prop:"name"},{default:t(()=>[e(L,{minlength:"1",maxlength:"60",modelValue:o(l).name,"onUpdate:modelValue":i[4]||(i[4]=u=>o(l).name=u),modelModifiers:{trim:!0},"show-word-limit":"",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(w,{label:"CIDR",prop:"cidr"},{default:t(()=>[e(L,{modelValue:o(l).cidr,"onUpdate:modelValue":i[5]||(i[5]=u=>o(l).cidr=u),modelModifiers:{trim:!0},minlength:"1",maxlength:"90","show-word-limit":"",placeholder:"请输入CIDR,举例:192.168.1.0/24 或 fe80::acbc:1234:5678::/64"},null,8,["modelValue"])]),_:1}),e(w,{label:"策略"},{default:t(()=>[e(E,{modelValue:o(l).net_policy,"onUpdate:modelValue":i[6]||(i[6]=u=>o(l).net_policy=u)},{default:t(()=>[e(c,{value:"Y"},{default:t(()=>[d("允许")]),_:1}),e(c,{value:"N"},{default:t(()=>[d("拒绝")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"策略编号"},{default:t(()=>[e(re,{modelValue:o(l).policy_no,"onUpdate:modelValue":i[7]||(i[7]=u=>o(l).policy_no=u),min:1,max:65535},null,8,["modelValue"])]),_:1}),e(w,{label:"过期时间"},{default:t(()=>[e(pe,{modelValue:o(l).expiry_at,"onUpdate:modelValue":i[8]||(i[8]=u=>o(l).expiry_at=u),type:"datetime",placeholder:"选择策略过期时间"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),Ie={key:0},Le={key:1},Fe=F({__name:"LoginAudit",setup(H){const a=B(1),l=B(10),y=B(0),g=B([new Date(2020,1,1,0,0,0),new Date(2049,12,31,0,0,0)]);let m=z({login_audit_list:Array(),is_success:"N",client_ip:"",name:""});function r(){let N={occur_begin:P(g.value[0]).format("YYYY-MM-DD HH:mm:ss"),occur_end:P(g.value[1]).format("YYYY-MM-DD HH:mm:ss"),name:m.name,is_success:m.is_success,client_ip:m.client_ip,offset:a.value*l.value-l.value,limit:l.value};C.post("/api/login_audit/",N).then(p=>{p.data.code===0?(m.login_audit_list=p.data.data,y.value=p.data.count):V.error("获取登录审计信息错误")})}return S(()=>{r()}),(N,p)=>{const h=Q,k=W,_=K,s=Z,x=X,v=J,D=A,n=ee,i=de,c=G,E=se,w=O,$=ve,U=j;return Y(),T(U,{label:"登录审计",name:"loginAudit"},{default:t(()=>[e(i,{"body-style":{height:"36px","padding-top":"0px","padding-bottom":"0px"}},{default:t(()=>[e(n,{style:{height:"24px","padding-top":"6px"}},{default:t(()=>[e(s,{span:4,style:{height:"24px"}},{default:t(()=>[e(_,{label:"登录状态"},{default:t(()=>[e(k,{modelValue:o(m).is_success,"onUpdate:modelValue":p[0]||(p[0]=b=>o(m).is_success=b)},{default:t(()=>[e(h,{value:"N"},{default:t(()=>[d("失败")]),_:1}),e(h,{value:"Y"},{default:t(()=>[d("成功")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),d("      "),e(s,{span:8,style:{height:"24px"}},{default:t(()=>[e(_,{label:"时间范围"},{default:t(()=>[e(x,{id:"time_range",modelValue:g.value,"onUpdate:modelValue":p[1]||(p[1]=b=>g.value=b),type:"datetimerange","range-separator":"To","start-placeholder":"起始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),_:1})]),_:1}),d("      "),e(s,{span:4,style:{height:"24px"}},{default:t(()=>[e(_,{label:"用户名"},{default:t(()=>[e(v,{modelValue:o(m).name,"onUpdate:modelValue":p[2]||(p[2]=b=>o(m).name=b)},null,8,["modelValue"])]),_:1})]),_:1}),d("      "),e(s,{span:4,style:{"text-align":"right",height:"24px"}},{default:t(()=>[e(_,{label:"客户端IP"},{default:t(()=>[e(v,{modelValue:o(m).client_ip,"onUpdate:modelValue":p[3]||(p[3]=b=>o(m).client_ip=b)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:2,style:{"text-align":"right",height:"24px"}},{default:t(()=>[e(D,{type:"primary",onClick:r},{default:t(()=>[d("搜索")]),_:1})]),_:1})]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(n,null,{default:t(()=>[e(w,{data:o(m).login_audit_list,style:{width:"100%"},"show-overflow-tooltip":!0},{default:t(()=>[e(c,{sortable:"",prop:"id",label:"ID",width:"150"}),e(c,{sortable:"",prop:"name",label:"用户名"}),e(c,{sortable:"",prop:"pwd",label:"密码"}),e(c,{sortable:"",prop:"client_ip",label:"客户端"}),e(c,{sortable:"",prop:"user_agent",label:"userAgent"}),e(c,{sortable:"",prop:"err_msg",label:"错误信息"}),e(c,{sortable:"",prop:"is_success",label:"状态"},{default:t(b=>[b.row.is_success==="Y"?(Y(),R("div",Ie,[e(E,{type:"success"},{default:t(()=>[d("成功")]),_:1})])):(Y(),R("div",Le,[e(E,{type:"danger"},{default:t(()=>[d("失败")]),_:1})]))]),_:1}),e(c,{sortable:"",prop:"occur_at",label:"发生时间"})]),_:1},8,["data"])]),_:1}),e(n,{style:{"margin-top":"20px"}},{default:t(()=>[e($,{"current-page":a.value,"onUpdate:currentPage":p[4]||(p[4]=b=>a.value=b),"page-size":l.value,"onUpdate:pageSize":p[5]||(p[5]=b=>l.value=b),"page-sizes":[10,20,50,100],size:"small",background:!0,layout:"total, sizes, prev, pager, next, jumper",total:y.value,onSizeChange:r,onCurrentChange:r},null,8,["current-page","page-size","total"])]),_:1})]),_:1})]),_:1})}}}),Ae=F({__name:"Manage",setup(H){let a=he(),l=we(),y=z({active_name:"accoutManage"});function g(){a.push({name:"Home"})}function m(){l.logout(),a.push({name:"Login"})}return(r,N)=>{const p=A,h=Ve,k=Z,_=ee,s=Ce,x=Ne,v=ke,D=Ue;return Y(),T(D,null,{default:t(()=>[e(s,{style:{"text-align":"left",height:"24px","padding-left":"0px","padding-right":"0px"}},{default:t(()=>[e(_,null,{default:t(()=>[e(k,{span:12},{default:t(()=>[e(h,null,{default:t(()=>[e(p,{type:"primary",onClick:g},{default:t(()=>[d("回到主页")]),_:1})]),_:1})]),_:1}),e(k,{span:12,style:{"text-align":"right"}},{default:t(()=>[e(h,null,{default:t(()=>[e(p,{type:"danger",onClick:m},{default:t(()=>[d("退出")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[q("div",null,[e(x,{modelValue:o(y).active_name,"onUpdate:modelValue":N[0]||(N[0]=n=>o(y).active_name=n),type:"card"},{default:t(()=>[e(Ye),e(Be),e(Fe),e($e)]),_:1},8,["modelValue"])])]),_:1})]),_:1})}}});export{Ae as default};
