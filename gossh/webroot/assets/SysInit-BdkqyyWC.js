import{d as F,K as G,r as j,z as A,y as z,R as H,a as d,A as b,b as t,w as e,f as s,S as r,e as n,c,T as w,u as K,L as W,E as _,g as C,N as J,B as O,U as X,V as Y,W as Z,n as $,p as ee,m as te,l as le,G as oe,i as se,j as ne,s as ae,F as de,P as re,Q as ue}from"./index-BFPhbx9o.js";const ie=s("h1",{style:{"text-align":"center"}},"系统初始化",-1),_e={key:0},pe=s("div",{class:"card-header"},[s("span",null,"样例:  gowebssh.db")],-1),ce=s("div",{class:"card-header"},[s("span",null,"样例:  root:mypwd@tcp(192.168.150.110:3306)/mydb?charset=utf8mb4&parseTime=True&loc=Local")],-1),me=s("div",{class:"card-header"},[s("span",null,"样例:  host=192.168.150.110 port=5432 user=postgres dbname=mydb sslmode=disable password=mypwd")],-1),fe={key:1},ye={key:2},he=s("div",{class:"card-header"},[s("span",null,"配置确认,请妥善保存密码")],-1),be={key:4},we=F({__name:"SysInit",setup(ge){let k=G(),q=W();const l=j({sqlite_dbdsn:"",mysql_dbdsn:"",pgsql_dbdsn:"",db_type:"mysql",name:"",pwd:""});let V=A(()=>l.db_type=="mysql"?l.mysql_dbdsn:l.db_type=="pgsql"?l.pgsql_dbdsn:l.db_type=="sqlite"?l.sqlite_dbdsn:"");const a=z(0),N=()=>{a.value--<0&&(a.value=0)},B=()=>{a.value++>2&&(a.value=0)};function D(){let i=V.value.trim();if(i.length<10){_.error("请输入正确配置");return}C.post("/api/sys/db_conn_check",{db_type:l.db_type,db_dsn:i}).then(o=>{o.data.code===0?_.success("连接数据库成功"):_.error("连接数据库错误:"+o.data.msg)}).catch(o=>{_.error("连接数据库错误异常")})}function S(i){let o="";const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",v=g.length;for(let m=0;m<i;m++)o+=g.charAt(Math.floor(Math.random()*v));return o}function E(){let i={db_type:l.db_type,db_dsn:V.value.trim(),jwt_secret:S(64),session_secret:S(64),username:l.name.trim(),password:l.pwd.trim()};if(i.db_dsn.length<5){_.error("系统初始化错误:请输入正确的数据库连接");return}if(i.username.length<2){_.error("系统初始化错误:用户名至少两个字符");return}if(i.password.length<2){_.error("系统初始化错误:密码至少两个字符");return}C.post("/api/sys/init",i).then(o=>{o.data.code===0?(_.success("系统初始化成功"),k.isInit=!0,q.push({name:"Login"})):_.error("系统初始化错误:"+o.data.msg)}).catch(o=>{console.log(o),_.error("系统初始化错误异常")})}return H(()=>{k.isInit&&q.push({name:"Login"})}),(i,o)=>{const g=J,v=O,m=X,L=Y,M=Z,x=$,T=ee,p=te,y=le,f=oe,h=se,U=ne,I=ae,Q=de,P=re,R=ue;return d(),b("div",null,[t(R,null,{default:e(()=>[t(g,null,{default:e(()=>[ie]),_:1}),t(P,null,{default:e(()=>[t(Q,null,{default:e(()=>[t(v,{span:4}),t(v,{span:16},{default:e(()=>[s("div",null,[t(L,{active:a.value,"finish-status":"success"},{default:e(()=>[t(m,{title:"数据库选择"}),t(m,{title:"账号配置"}),t(m,{title:"完成"})]),_:1},8,["active"]),t(M),t(I,{model:l},{default:e(()=>[a.value===0?(d(),b("div",_e,[t(p,{label:"数据库"},{default:e(()=>[t(T,{modelValue:l.db_type,"onUpdate:modelValue":o[0]||(o[0]=u=>l.db_type=u)},{default:e(()=>[r("",!0),t(x,{value:"mysql"},{default:e(()=>[n("MySQL")]),_:1}),t(x,{value:"pgsql"},{default:e(()=>[n("PostgresSQL")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.db_type==="sqlite"?(d(),c(p,{key:0},{default:e(()=>[t(f,{style:{width:"100%"}},{header:e(()=>[pe]),default:e(()=>[t(y,{modelValue:l.mysql_dbdsn,"onUpdate:modelValue":o[1]||(o[1]=u=>l.mysql_dbdsn=u),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入数据库DSN,参考上面的样例"},{prepend:e(()=>[n("数据库DSN")]),_:1},8,["modelValue"])]),_:1})]),_:1})):r("",!0),l.db_type==="mysql"?(d(),c(p,{key:1},{default:e(()=>[t(f,{style:{width:"100%"}},{header:e(()=>[ce]),default:e(()=>[t(y,{modelValue:l.mysql_dbdsn,"onUpdate:modelValue":o[2]||(o[2]=u=>l.mysql_dbdsn=u),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入数据库DSN,参考上面的样例"},{prepend:e(()=>[n("数据库DSN")]),_:1},8,["modelValue"])]),_:1})]),_:1})):r("",!0),l.db_type==="pgsql"?(d(),c(p,{key:2},{default:e(()=>[t(f,{style:{width:"100%"}},{header:e(()=>[me]),default:e(()=>[t(y,{modelValue:l.pgsql_dbdsn,"onUpdate:modelValue":o[3]||(o[3]=u=>l.pgsql_dbdsn=u),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入数据库DSN,参考上面的样例"},{prepend:e(()=>[n("数据库DSN")]),_:1},8,["modelValue"])]),_:1})]),_:1})):r("",!0)])):r("",!0),a.value===1?(d(),b("div",fe,[s("div",null,[t(p,null,{default:e(()=>[t(f,{style:{width:"100%"}},{default:e(()=>[t(y,{modelValue:l.name,"onUpdate:modelValue":o[4]||(o[4]=u=>l.name=u),trim:"",minlength:"1",maxlength:"64","show-word-limit":"",clearable:"",placeholder:"请输入用户名"},{prepend:e(()=>[n("账号")]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(p,null,{default:e(()=>[t(f,{style:{width:"100%"}},{default:e(()=>[t(y,{modelValue:l.pwd,"onUpdate:modelValue":o[5]||(o[5]=u=>l.pwd=u),trim:"",type:"password",minlength:"3",maxlength:"64","show-word-limit":"","show-password":"",clearable:"",placeholder:"请输入密码"},{prepend:e(()=>[n("密码")]),_:1},8,["modelValue"])]),_:1})]),_:1})])])):r("",!0),a.value===2?(d(),b("div",ye,[t(p,null,{default:e(()=>[t(f,{style:{width:"100%"}},{header:e(()=>[he]),default:e(()=>[s("p",null,"数据库类型:  "+w(l.db_type==="pgsql"?"PostgreSQL":"MySQL"),1),s("p",null,"数据库DSN:  "+w(K(V)),1),s("p",null,"账号:  "+w(l.name),1),s("p",null,"密码:  "+w(l.pwd),1)]),_:1})]),_:1})])):r("",!0),s("div",null,[t(p,null,{default:e(()=>[a.value===0?(d(),c(h,{key:0,type:"success",onClick:D},{default:e(()=>[n("测试连接")]),_:1})):r("",!0),a.value>0?(d(),c(h,{key:1,type:"primary",onClick:N},{default:e(()=>[n("上一步")]),_:1})):r("",!0),a.value<2?(d(),c(h,{key:2,type:"primary",onClick:B},{default:e(()=>[n("下一步")]),_:1})):r("",!0),a.value===2?(d(),c(h,{key:3,type:"success",onClick:E},{default:e(()=>[n("完成")]),_:1})):r("",!0),n("                    "),a.value===2?(d(),b("div",be,[t(U,{confirmButtonText:"确定",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定初始化",onConfirm:E},{reference:e(()=>[n("   "),t(h,{type:"success"},{default:e(()=>[n("完成")]),_:1})]),_:1})])):r("",!0)]),_:1})])]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{we as default};
